<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Blackjack with Supabase</title>

<!-- Materialize CSS -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css" />
<!-- Material Icons -->
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
<!-- Custom styles -->
<link rel="stylesheet" type="text/css" href="css/keyframes.css" />
<link rel="stylesheet" type="text/css" href="css/style.css" />

<!-- Supabase SDK -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js/dist/supabase.min.js"></script>
</head>
<body>

<!-- Login/Register Modal -->
<div id="auth-modal" class="modal">
  <div class="modal-content">
    <h4>Login or Register</h4>
    <div class="input-field">
      <input type="email" id="auth-email" placeholder="Email" />
    </div>
    <div class="input-field">
      <input type="password" id="auth-password" placeholder="Password" />
    </div>
    <button id="login-btn" class="btn">Login</button>
    <button id="register-btn" class="btn">Register</button>
  </div>
</div>

<!-- User Info -->
<div id="user-info" style="display:none; padding: 10px;">
  <p>Welcome, <span id="user-email"></span></p>
  <p>Coins: <span class="current-chip-balance">Loading...</span></p>
  <button id="logout-btn" class="btn red">Logout</button>
</div>

<!-- Rules overlay -->
<div class="navbar-fixed z-depth-0">
  <nav>
    <div class="nav-wrapper">
      <span class="left brand-logo"></span>
      <ul id="nav-mobile" class="right">
        <li><a href="#" id="rules-nav"><i class="material-icons">help</i></a></li>
        <li><a href="#" id="reset-game">Reset Game</a></li>
      </ul>
    </div>
  </nav>
</div>

<div id="rules" class="container" style="display:none;">
  <div class="row">
    <div class="col s12">
      <h4>Game Rules</h4>
    </div>
  </div>
  <div class="row">
    <div class="col s12 m6">
      <p><strong>Goal</strong> Beat the dealer by getting a hand as close to 21 as possible, without going over 21. A blackjack occurs when you get one ace and one 10 point card, without having split the deck first.</p>
      <p><strong>Gameplay</strong> The dealer will give 2 cards to themselves and 2 cards to you. The dealer's second card will be face down. You can choose to hit (receive more cards) or stand. You can hit as many times as you choose so long as your total is under 21.</p>
      <p><strong>Card Values</strong> Queens, Kings, and Jacks are worth 10, pip cards are worth their face value, but Aces can be worth 11 or 1. Aces default to 11 unless your total exceeds 21, then they count as 1.</p>
    </div>
    <div class="col s12 m6">
      <p><strong>Splitting Pairs</strong> If you receive 2 cards of the same face value, you may split your hand once. After splitting, one new card is dealt to each hand, then you can hit or stand for each hand separately.</p>
      <p><strong>Betting</strong> Bets must be placed before playing. After receiving initial cards, you can double down (double your bet). After your move, you can't double down again.</p>
      <p><strong>Payout</strong> 1:1 unless blackjack, then 3:2.</p>
      <button id="rules-close" class="btn">Close</button>
    </div>
  </div>
</div>

<!-- Wager options and game start -->
<div class="container" id="welcome">
  <div class="row">
    <div class="col s12 center-align" style="margin-top:20px;">
      <h1>Blackjack</h1>
      <p>Start playing by selecting your bet below. To view the rules, click the help icon in the top right.</p>
      <div id="wager-options" style="margin-top:20px;">
        <a href="#" id="chip-10"><img src="img/10-chip.png" class="wager wager-clickable"></a>
        <a href="#" id="chip-25"><img src="img/25-chip.png" class="wager wager-clickable"></a>
        <a href="#" id="chip-50"><img src="img/50-chip.png" class="wager wager-clickable"></a>
        <a href="#" id="chip-100"><img src="img/100-chip.png" class="wager wager-clickable"></a>
        <br /><br />
        <span class="current-wager">0</span>
        <img src="img/pile-chip.png" class="wager-small" />
        <span class="current-chip-balance">Loading...</span>
        <br /><br />
        <button id="start-game-button" class="btn green" disabled>Play</button>
      </div>
    </div>
  </div>
</div>

<!-- Game Board -->
<div class="container inactive" id="game-board" style="margin-top:20px;">
  <!-- Dealer Area -->
  <div class="row">
    <div class="col m8 s12">
      <h4>Dealer</h4>
      <div id="deck-pile" class="hide-on-small-only">
        <img src="img/card_back.png" class="card pile" />
      </div>
      <div id="dealer"></div>
      <span class="dealer-hand-total game-board-totals"></span>
    </div>
    <!-- Chips info -->
    <div class="col s12 m4">
      <div class="row">
        <div class="col m6 s6">
          <img src="img/blank-chip.png" class="wager" />
          <span class="current-wager">___</span>
        </div>
        <div class="col m6 s6">
          <img src="img/pile-chip.png" class="wager" />
          <span class="current-chip-balance">___</span>
        </div>
      </div>
    </div>
  </div>
  <!-- Player Area -->
  <div class="row" style="margin-top:20px;">
    <div class="col s12 m8">
      <h4>Player</h4>
      <div id="user-hand"></div>
      <span class="hand-total game-board-totals">0</span>
      <div id="user-split-hand" class="inactive"></div>
      <span class="split-hand-total game-board-totals inactive">0</span>
    </div>
    <!-- Buttons -->
    <div class="col s12 m4" id="sidebar" style="margin-top:20px;">
      <div class="row">
        <div class="col s4">
          <button id="hit-button" class="btn blue">Hit</button>
        </div>
        <div class="col s4">
          <button id="double-down-button" class="btn orange">Double</button>
        </div>
        <div class="col s4">
          <button id="stand-button" class="btn purple">Stand</button>
        </div>
        <div class="col s12" style="margin-top:10px;">
          <button class="split-button btn grey" disabled>Split</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Game Over Modal -->
<div id="game-over" class="modal">
  <div class="modal-content">
    <h4 id="game-outcome">Win message here</h4>
    <table>
      <tr>
        <td class="total-label"><h5>Dealer</h5></td>
        <td class="total-output"><span class="dealer-hand-total"></span></td>
      </tr>
      <tr>
        <td class="total-label"><h5>Player</h5></td>
        <td class="total-output"><span class="hand-total"></span></td>
      </tr>
    </table>
    <button class="btn green new-game-button">Play Again</button>
  </div>
</div>

<!-- Scripts -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<!-- Materialize JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
<!-- Your game JS files -->
<script src="js/cards.js"></script>
<script src="js/game-play-logic.js"></script>
<script src="js/game-win-logic.js"></script>
<script src="js/button-actions.js"></script>
<script src="js/main.js"></script>
<!-- Supabase and auth -->
<script src="js/auth.js"></script>
</body>
</html>